<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.13 (455674)"/><meta name="author" content="Greg Xu"/><meta name="created" content="2011-03-12 10:17:08 +0000"/><meta name="source-url" content="http://www.zhuoda.org/elite/34441.html"/><meta name="updated" content="2013-05-04 05:35:29 +0000"/><title>13.3 文件的打开与关闭</title></head><body><div>13.3 文件的打开与关闭<br clear="none"/> 文件在进行读写操作之前要先打开，使用完毕要关闭。所谓打开文件，实际上是建立文件的各种有关信息，并使文件指针指向该文件，以便进行其它操作。关闭文件则断开指针与文件之间的联系，也就禁止再对该文件进行操作。<br clear="none"/><br clear="none"/> 在Ｃ语言中，文件操作都是由库函数来完成的。在本章内将介绍主要的文件操作函数。<br clear="none"/><br clear="none"/> 13.3.1 文件的打开(fopen函数)<br clear="none"/> fopen函数用来打开一个文件，其调用的一般形式为：<br clear="none"/><br clear="none"/> 文件指针名=fopen(文件名,使用文件方式);<br clear="none"/><br clear="none"/> 其中，<br clear="none"/><br clear="none"/> “文件指针名”必须是被说明为FILE 类型的指针变量；<br clear="none"/><br clear="none"/> “文件名”是被打开文件的文件名；<br clear="none"/><br clear="none"/> “使用文件方式”是指文件的类型和操作要求。<br clear="none"/><br clear="none"/> “文件名”是字符串常量或字符串数组。<br clear="none"/><br clear="none"/> 例如：<br clear="none"/><br clear="none"/> FILE *fp；<br clear="none"/><br clear="none"/> fp=("file a","r");<br clear="none"/><br clear="none"/> 其意义是在当前目录下打开文件file a，只允许进行“读”操作，并使fp指向该文件。<br clear="none"/><br clear="none"/> 又如：<br clear="none"/><br clear="none"/> FILE *fphzk<br clear="none"/><br clear="none"/> fphzk=("c:\\hzk16","rb")<br clear="none"/><br clear="none"/> 其意义是打开C驱动器磁盘的根目录下的文件hzk16，这是一个二进制文件，只允许按二进制方式进行读操作。两个反斜线“\\ ”中的第一个表示转义字符，第二个表示根目录。<br clear="none"/><br clear="none"/> 使用文件的方式共有12种，下面给出了它们的符号和意义。<br clear="none"/><br clear="none"/> 文件使用方式<br clear="none"/> 意义<br clear="none"/><br clear="none"/> “rt”<br clear="none"/> 只读打开一个文本文件，只允许读数据<br clear="none"/><br clear="none"/> “wt”<br clear="none"/> 只写打开或建立一个文本文件，只允许写数据<br clear="none"/><br clear="none"/> “at”<br clear="none"/> 追加打开一个文本文件，并在文件末尾写数据<br clear="none"/><br clear="none"/> “rb”<br clear="none"/> 只读打开一个二进制文件，只允许读数据<br clear="none"/><br clear="none"/> “wb”<br clear="none"/> 只写打开或建立一个二进制文件，只允许写数据<br clear="none"/><br clear="none"/> “ab”<br clear="none"/> 追加打开一个二进制文件，并在文件末尾写数据<br clear="none"/><br clear="none"/> “rt+”<br clear="none"/> 读写打开一个文本文件，允许读和写<br clear="none"/><br clear="none"/> “wt+”<br clear="none"/> 读写打开或建立一个文本文件，允许读写<br clear="none"/><br clear="none"/> “at+”<br clear="none"/> 读写打开一个文本文件，允许读，或在文件末追加数据<br clear="none"/><br clear="none"/> “rb+”<br clear="none"/> 读写打开一个二进制文件，允许读和写<br clear="none"/><br clear="none"/> “wb+”<br clear="none"/> 读写打开或建立一个二进制文件，允许读和写<br clear="none"/><br clear="none"/> “ab+”<br clear="none"/> 读写打开一个二进制文件，允许读，或在文件末追加数据<br clear="none"/><br clear="none"/><br clear="none"/> 对于文件使用方式有以下几点说明：<br clear="none"/><br clear="none"/> 1) 文件使用方式由r,w,a,t,b，+六个字符拼成，各字符的含义是：<br clear="none"/><br clear="none"/> r(read): 读<br clear="none"/><br clear="none"/> w(write): 写<br clear="none"/><br clear="none"/> a(append): 追加<br clear="none"/><br clear="none"/> t(text): 文本文件，可省略不写<br clear="none"/><br clear="none"/> b(banary): 二进制文件<br clear="none"/><br clear="none"/> +: 读和写<br clear="none"/><br clear="none"/> 2) 凡用“r”打开一个文件时，该文件必须已经存在，且只能从该文件读出。<br clear="none"/><br clear="none"/> 3) 用“w”打开的文件只能向该文件写入。若打开的文件不存在，则以指定的文件名建立该文件，若打开的文件已经存在，则将该文件删去，重建一个新文件。<br clear="none"/><br clear="none"/> 4) 若要向一个已存在的文件追加新的信息，只能用“a”方式打开文件。但此时该文件必须是存在的，否则将会出错。<br clear="none"/><br clear="none"/> 5) 在打开一个文件时，如果出错，fopen将返回一个空指针值NULL。在程序中可以用这一信息来判别是否完成打开文件的工作，并作相应的处理。因此常用以下程序段打开文件：<br clear="none"/><br clear="none"/> 6) if((fp=fopen("c:\\hzk16","rb")==NULL)<br clear="none"/><br clear="none"/> {<br clear="none"/><br clear="none"/> printf("\nerror on open c:\\hzk16 file!");<br clear="none"/><br clear="none"/> getch();<br clear="none"/><br clear="none"/> exit(1);<br clear="none"/><br clear="none"/> }<br clear="none"/><br clear="none"/> 这 段程序的意义是，如果返回的指针为空，表示不能打开C盘根目录下的hzk16文件，则给出提示信息“error on open c:\ hzk16 file!”，下一行getch()的功能是从键盘输入一个字符，但不在屏幕上显示。在这里，该行的作用是等待，只有当用户从键盘敲任一lose函数返回 值为0。如返回非零值则表示有错误发生。<br clear="none"/><br clear="none"/> 13.4 文件的读写<br clear="none"/> 对文件的读和写是最常用的文件操作。在Ｃ语言中提供了多种文件读写的函数：<br clear="none"/><br clear="none"/> ·字符读写函数 ：fgetc和fputc<br clear="none"/><br clear="none"/> ·字符串读写函数：fgets和fputs<br clear="none"/><br clear="none"/> ·数据块读写函数：freed和fwrite<br clear="none"/><br clear="none"/> ·格式化读写函数：fscanf和fprinf<br clear="none"/><br clear="none"/> 下面分别予以介绍。使用以上函数都要求包含头文件stdio.h。<br clear="none"/><br clear="none"/> 13.4.1 字符读写函数fgetc和fputc<br clear="none"/> 字符读写函数是以字符(字节)为单位的读写函数。每次可从文件读出或向文件写入一个字符。<br clear="none"/><br clear="none"/> 1. 读字符函数fgetc<br clear="none"/><br clear="none"/> fgetc函数的功能是从指定的文件中读一个字符，函数调用的形式为：<br clear="none"/><br clear="none"/> 字符变量=fgetc(文件指针)；<br clear="none"/><br clear="none"/> 例如：<br clear="none"/><br clear="none"/> ch=fgetc(fp);<br clear="none"/><br clear="none"/> 其意义是从打开的文件fp中读取一个字符并送入ch中。<br clear="none"/><br clear="none"/> 对于fgetc函数的使用有以下几点说明：<br clear="none"/><br clear="none"/> 1) 在fgetc函数调用中，读取的文件必须是以读或读写方式打开的。<br clear="none"/><br clear="none"/> 2) 读取字符的结果也可以不向字符变量赋值，<br clear="none"/><br clear="none"/> 例如：<br clear="none"/><br clear="none"/> fgetc(fp);<br clear="none"/><br clear="none"/> 但是读出的字符不能保存。<br clear="none"/><br clear="none"/> 3) 在文件内部有一个位置指针。用来指向文件的当前读写字节。在文件打开时，该指针总是指向文件的第一个字节。使用fgetc 函数后，该位置指针将向后移动一个字节。 因此可连续多次使用fgetc函数，读取多个字符。应注意文件指针和文件内部的位置指针不是一回事。文件指针是指向整个文件的，须在程序中定义说明，只要 不重新赋值，文件指针的值是不变的。文件内部的位置指针用以指示文件内部的当前读写位置，每读写一次，该指针均向后移动，它不需在程序中定义说明，而是由 系统自动设置的。<br clear="none"/><br clear="none"/> 【例13.1】读入文件c1.doc，在屏幕上输出。<br clear="none"/><br clear="none"/> #include&lt;stdio.h&gt;<br clear="none"/> main()<br clear="none"/> {<br clear="none"/> FILE *fp;<br clear="none"/><span style="color: blue; font-size: x-small;">char</span> ch;<br clear="none"/><span style="color: blue; font-size: x-small;">if</span>((fp=fopen(<span style="color: #00bb00; font-size: x-small;">"d:\\jrzh\\example\\c1.txt"</span><span style="color: black; font-size: x-small;">,</span><span style="color: #00bb00; font-size: x-small;">"rt"</span><span style="color: black; font-size: x-small;">))==NULL)<br clear="none"/> {<br clear="none"/> printf(</span><span style="color: #00bb00; font-size: x-small;">"\nCannot open file strike any key exit!"</span><span style="color: black; font-size: x-small;">);<br clear="none"/> getch();<br clear="none"/> exit(1);<br clear="none"/> }<br clear="none"/> ch=fgetc(fp);<br clear="none"/><span style="color: blue; font-size: x-small;">while</span>(ch!=EOF)<br clear="none"/> {<br clear="none"/> putchar(ch);<br clear="none"/> ch=fgetc(fp);<br clear="none"/> }<br clear="none"/> fclose(fp);<br clear="none"/> }<br clear="none"/><br clear="none"/> 本 例程序的功能是从文件中逐个读取字符，在屏幕上显示。程序定义了文件指针fp,以读文本文件方式打开文件“d:\\jrzh\\example \\ex1_1.c”，并使fp指向该文件。如打开文件出错，给出提示并退出程序。程序第12行先读出一个字符，然后进入循环，只要读出的字符不是文件结 束标志(每上，再读入下一字符。每读一次，文件内部的位置指针向后??本程序将显示整个文件。<br clear="none"/><br clear="none"/> 2. 写字符函数fputc<br clear="none"/><br clear="none"/> fputc函数的功能??为：<br clear="none"/><br clear="none"/> fputc(字符量，文件指量或变量，例如：<br clear="none"/><br clear="none"/> fputc('a',fp);<br clear="none"/><br clear="none"/> 其意putc函数的使用也要说明几点：<br clear="none"/><br clear="none"/> 1) 被写入的文件可以用写、读写、追加方式打开，用写或读写方式??写入字符从文件首开始。如需保留原有文件内容，希望写入的字??被写入的文件若不存在，则创建该文件。<br clear="none"/><br clear="none"/> 2) 每写入一个字符，文件内部位置指针向后移动一个字节。<br clear="none"/><br clear="none"/> 3) fputc函数有一个返回值，如写入成功则返回写入的字符，否则返回一个EOF。可用此来判断写符，写入一个文件，再把该文件内容读出显示在屏幕上。<br clear="none"/><br clear="none"/> #include&lt;stdio.h&gt;<br clear="none"/><br clear="none"/> main()<br clear="none"/><br clear="none"/> {<br clear="none"/><br clear="none"/> FILE *fp;<br clear="none"/><br clear="none"/><span style="color: blue; font-size: x-small;">char</span> ch;<br clear="none"/><br clear="none"/><span style="color: blue; font-size: x-small;">if</span>((fp=fopen(</span><span style="color: #00bb00; font-size: x-small;">"d:\\jrzh\\example\\string"</span><span style="color: black; font-size: x-small;">,</span><span style="color: #00bb00; font-size: x-small;">"wt+"</span><span style="color: black; font-size: x-small;">))==NULL)<br clear="none"/><br clear="none"/> {<br clear="none"/><br clear="none"/> printf(</span><span style="color: #00bb00; font-size: x-small;">"Cannot open file strike any key exit!"</span><span style="color: black; font-size: x-small;">);<br clear="none"/><br clear="none"/> getch();<br clear="none"/><br clear="none"/> exit(1);<br clear="none"/><br clear="none"/> }<br clear="none"/><br clear="none"/> printf(</span><span style="color: #00bb00; font-size: x-small;">"input a string:\n"</span><span style="color: black; font-size: x-small;">);<br clear="none"/><br clear="none"/> ch=getchar();<br clear="none"/><br clear="none"/><span style="color: blue; font-size: x-small;">while</span> (ch!='\n')<br clear="none"/><br clear="none"/> {<br clear="none"/><br clear="none"/> fputc(ch,fp);<br clear="none"/><br clear="none"/> ch=getchar();<br clear="none"/><br clear="none"/> }<br clear="none"/><br clear="none"/> rewind(fp);<br clear="none"/><br clear="none"/> ch=fgetc(fp);<br clear="none"/><br clear="none"/><span style="color: blue; font-size: x-small;">while</span>(ch!=EOF)<br clear="none"/><br clear="none"/> {<br clear="none"/><br clear="none"/> putchar(ch);<br clear="none"/><br clear="none"/> ch=fgetc(fp);<br clear="none"/><br clear="none"/> }<br clear="none"/><br clear="none"/> printf(</span><span style="color: #00bb00; font-size: x-small;">"\n"</span><span style="color: black; font-size: x-small;">);<br clear="none"/><br clear="none"/> fclose(fp);<br clear="none"/><br clear="none"/> }<br clear="none"/><br clear="none"/><br clear="none"/> 程 序中第6行以读写文本文件方式打开文件string。程序第13行从键盘读入一个字符后进入循环，当读入字符不为回车符时，则把该字符写入文件之中，然后 继续从键盘读入下一字符。每输入一个字符，文件内部位置指针向后移动一个字节。写入完毕，该指针已指向文件末。如要把文件从头读出，须把指针移向文件头， 程序第19行rewind函数用于把fp所指文件的内部位置指针移到文件头。第20至25行用于读出文件中的一行内容。<br clear="none"/><br clear="none"/> 【例13.3】把命令行参数中的前一个文件名标识的文件，复制到后一个文件名标识的文件中，如命令行中只有一个文件名则把该文件写到标准输出文件(显示器)中。<br clear="none"/><br clear="none"/> #include&lt;stdio.h&gt;<br clear="none"/><br clear="none"/> main(<span style="color: blue; font-size: x-small;">int</span> argc,<span style="color: blue; font-size: x-small;">char</span> *argv[])<br clear="none"/><br clear="none"/> {<br clear="none"/><br clear="none"/> FILE *fp1,*fp2;<br clear="none"/><br clear="none"/><span style="color: blue; font-size: x-small;">char</span> ch;<br clear="none"/><br clear="none"/><span style="color: blue; font-size: x-small;">if</span>(argc==1)<br clear="none"/><br clear="none"/> {<br clear="none"/><br clear="none"/> printf(</span><span style="color: #00bb00; font-size: x-small;">"have not enter file name strike any key exit"</span><span style="color: black; font-size: x-small;">);<br clear="none"/><br clear="none"/> getch();<br clear="none"/><br clear="none"/> exit(0);<br clear="none"/><br clear="none"/> }<br clear="none"/><br clear="none"/><span style="color: blue; font-size: x-small;">if</span>((fp1=fopen(argv[1],</span><span style="color: #00bb00; font-size: x-small;">"rt"</span><span style="color: black; font-size: x-small;">))==NULL)<br clear="none"/><br clear="none"/> {<br clear="none"/><br clear="none"/> printf(</span><span style="color: #00bb00; font-size: x-small;">"Cannot open %s\n"</span><span style="color: black; font-size: x-small;">,argv[1]);<br clear="none"/><br clear="none"/> g</span></div>
<div><span style="color: black; font-size: x-small;"><span style="border-collapse: separate; color: #000000; font-family: 微软雅黑; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: 2; text-align: -webkit-auto; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; font-size: medium;"><span style="color: #aaaaaa; font-size: 9px;"><br clear="none"/> | Style : Background14, Font0, Size16 |</span></span></span></div></body></html>